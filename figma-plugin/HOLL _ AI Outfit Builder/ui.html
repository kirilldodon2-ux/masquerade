<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>HÓLL — AI Outfit Builder</title>
    <style>
      body {
        margin: 0;
        padding: 16px;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        background: #050509;
        color: #f5f5f5;
      }

      h1 {
        font-size: 16px;
        margin: 0 0 8px;
      }

      p.subtitle {
        font-size: 11px;
        opacity: 0.7;
        margin: 0 0 16px;
      }

      label {
        font-size: 11px;
        display: block;
        margin-bottom: 4px;
        opacity: 0.85;
      }

      textarea {
        width: 100%;
        height: 80px;
        resize: vertical;
        border-radius: 8px;
        border: 1px solid #404040;
        background: #101018;
        color: #f5f5f5;
        padding: 8px;
        font-size: 11px;
        box-sizing: border-box;
      }

      .row {
        display: flex;
        gap: 8px;
        margin-top: 12px;
      }

      .pill-group {
        flex: 1;
        display: flex;
        gap: 4px;
        flex-wrap: wrap;
      }

      .pill {
        flex: 1;
        min-width: 0;
        border-radius: 999px;
        border: 1px solid #303040;
        padding: 6px 10px;
        font-size: 11px;
        text-align: center;
        background: #101018;
        color: #d0d0e0;
        cursor: pointer;
        user-select: none;
      }

      .pill.active {
        background: linear-gradient(90deg, #5af, #9f7bff);
        color: #050509;
        border-color: transparent;
      }

      select {
        width: 100%;
        border-radius: 999px;
        padding: 6px 10px;
        border: 1px solid #303040;
        background: #101018;
        color: #d0d0e0;
        font-size: 11px;
      }

      button.primary {
        width: 100%;
        margin-top: 16px;
        border-radius: 999px;
        border: none;
        padding: 10px 12px;
        font-size: 12px;
        font-weight: 500;
        background: linear-gradient(90deg, #5af, #9f7bff);
        color: #050509;
        cursor: pointer;
      }

      button.primary:disabled {
        opacity: 0.4;
        cursor: default;
      }

      .status {
        margin-top: 6px;
        font-size: 10px;
        opacity: 0.8;
      }

      .status.error {
        color: #ff6b81;
      }

      .status.ok {
        color: #70ffb3;
      }
    </style>
  </head>
  <body>
    <h1>HÓLL — AI Outfit Builder</h1>
    <p class="subtitle">
      Select a collage frame in Figma → generate a ready outfit with
      Masquerade engine.
    </p>

    <label for="brief">Stylist brief / vibe</label>
    <textarea
      id="brief"
      placeholder="Example: boho chic, 70s gallery girl, warm city evening, soft cinematic light."
    ></textarea>

    <div class="row">
      <div class="pill-group" id="mode-group">
        <div class="pill active" data-value="outfit">Outfit from collage</div>
        <div class="pill" data-value="inspiration">Inspiration / moodboard</div>
      </div>
      <div class="pill-group" id="engine-group">
        <div class="pill active" data-value="nano">Nano Banana</div>
        <div class="pill" data-value="g3">Gemini-3 Image</div>
      </div>
    </div>

    <div style="margin-top: 12px">
      <label for="aspect">Aspect</label>
      <select id="aspect">
        <option value="auto">Auto (3:4 by brief)</option>
        <option value="3x4">3×4 vertical</option>
        <option value="9x16">9×16 stories</option>
        <option value="16x9">16×9 landscape</option>
      </select>
    </div>

    <button class="primary" id="run">Generate from selection</button>
    <div class="status" id="status"></div>

    <script>
      const briefEl = document.getElementById("brief");
      const runBtn = document.getElementById("run");
      const statusEl = document.getElementById("status");
      const aspectEl = document.getElementById("aspect");

      let mode = "outfit"; // or "inspiration"
      let engine = "nano"; // or "g3"

      function setStatus(text, kind) {
        statusEl.textContent = text || "";
        statusEl.className = "status";
        if (kind === "error") statusEl.classList.add("error");
        if (kind === "ok") statusEl.classList.add("ok");
      }

      function wirePills(groupId, onChange) {
        const group = document.getElementById(groupId);
        const pills = Array.from(group.querySelectorAll(".pill"));
        pills.forEach((pill) => {
          pill.addEventListener("click", () => {
            pills.forEach((p) => p.classList.remove("active"));
            pill.classList.add("active");
            onChange(pill.dataset.value);
          });
        });
      }

      wirePills("mode-group", (value) => {
        mode = value === "inspiration" ? "inspiration" : "outfit";
      });

      wirePills("engine-group", (value) => {
        engine = value === "g3" ? "g3" : "nano";
      });

      runBtn.addEventListener("click", () => {
        setStatus("Sending to Masquerade…", null);
        runBtn.disabled = true;

        const brief = briefEl.value.trim();
        const aspectValue = aspectEl.value; // "auto" | "3x4" | "9x16" | "16x9"

        const msg = {
          type: "generate-outfit",
          brief,
          inspirationMode: mode === "inspiration",
          engine,
          aspect: aspectValue === "auto" ? null : aspectValue,
        };

        parent.postMessage({ pluginMessage: msg }, "*");
      });

      // receive status from main code
      window.onmessage = (event) => {
        const msg = event.data.pluginMessage;
        if (!msg) return;

        if (msg.type === "error") {
          setStatus(msg.message || "Error", "error");
          runBtn.disabled = false;
        } else if (msg.type === "done") {
          setStatus("Done. Outfit node created near your collage.", "ok");
          runBtn.disabled = false;
        }
      };
    </script>
  </body>
</html>